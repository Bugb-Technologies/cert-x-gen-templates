# CERT-X-GEN YAML Template Skeleton
#
# Template to detect unauthenticated access to Ollama /api/generate endpoint
# that allows arbitrary prompt generation without authentication.
#
# Basic metadata -----------------------------------------------------------

id: ollama-unauth-api-generate
name: "Ollama Unauthenticated /api/generate Access"
author:
  name: "CERT-X-GEN Automated Generator"
  email: "cert-x-gen@example.com"
  github: "cert-x-gen"
severity: high
description: |
  Detects unauthenticated access to the Ollama API endpoint `/api/generate`.
  This endpoint, when exposed without authentication, allows arbitrary prompt
  generation and could lead to abuse or data leakage. The check sends a simple
  prompt and verifies if a valid generation response is returned.

tags:
  - ollama
  - unauth
  - api
  - abuse
  - security

language: yaml
confidence: 95

cve_ids: []
cwe_ids:
  - "CWE-306"  # Missing Authentication for Critical Function
cvss_score: 8.6
version: "1.0.0"

references:
  - https://ollama.ai/
  - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/

# HTTP-based template ------------------------------------------------------

http:
  - method: POST
    path:
      - "/api/generate"

    headers:
      Content-Type: "application/json"
      User-Agent: "cert-x-gen/1.0"

    body: |
      {
        "model": "llama2",
        "prompt": "Say hello"
      }

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "model"
          - "response"
        condition: and
        part: body

      - type: regex
        regex:
          - "\"response\"\\s*:\\s*\"[^\"]+\""

    extractors:
      - type: regex
        name: generated_text
        regex:
          - "\"response\"\\s*:\\s*\"([^\"]+)\""

# Remediation guidance ----------------------------------------------------

remediation: |
  1. Restrict access to the Ollama API endpoints to authenticated users only.
  2. Implement proper authentication and authorization controls for `/api/generate`.
  3. Avoid exposing Ollama endpoints to the public internet.
  4. Use network-level protections (firewalls, reverse proxies) to limit access.
  5. Review Ollama configuration and apply vendor-recommended security best practices.