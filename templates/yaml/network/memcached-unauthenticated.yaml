id: memcached-unauthenticated-access
name: "Memcached Unauthenticated Access Detection"
author:
  name: "CERT-X-GEN Security Team"
  email: "security@cert-x-gen.io"
severity: critical
description: |
  Detects Memcached instances exposed without authentication.
  Unauthenticated Memcached can be exploited for:
  - Data exfiltration (cache dumping)
  - DDoS amplification attacks
  - Cache poisoning

tags:
  - memcached
  - unauthenticated
  - cache
  - amplification
  - network
  - ddos

language: yaml
confidence: 95

cwe:
  - CWE-306

references:
  - https://cwe.mitre.org/data/definitions/306.html
  - https://github.com/memcached/memcached/wiki/SASLHowto
  - https://www.cloudflare.com/learning/ddos/memcached-ddos-attack/

network:
  - protocol: tcp
    port: 11211
    
    payloads:
      # Stats command
      - "stats\r\n"
      # Version command
      - "version\r\n"
      # Get stats items
      - "stats items\r\n"
      # Get stats slabs
      - "stats slabs\r\n"
    
    matchers-condition: or
    matchers:
      - type: word
        words:
          - "STAT version"
          - "STAT pid"
          - "STAT uptime"
          - "STAT curr_connections"
          - "STAT total_items"
        condition: or
        part: body
      
      - type: regex
        regex:
          - "VERSION \\d+\\.\\d+\\.\\d+"
          - "STAT \\w+"

  - protocol: udp
    port: 11211
    
    payloads:
      # UDP stats request (amplification test)
      - "\x00\x00\x00\x00\x00\x01\x00\x00stats\r\n"
    
    matchers:
      - type: word
        words:
          - "STAT"
        part: body

extractors:
  - type: regex
    name: memcached_version
    regex:
      - "VERSION (\\d+\\.\\d+\\.\\d+)"
  
  - type: regex
    name: current_connections
    regex:
      - "STAT curr_connections (\\d+)"
  
  - type: regex
    name: total_items
    regex:
      - "STAT total_items (\\d+)"

remediation: |
  1. Enable SASL authentication (Memcached 1.4.3+):
     memcached -S -u memcache
  
  2. Bind to localhost only:
     memcached -l 127.0.0.1
  
  3. Disable UDP (to prevent amplification):
     memcached -U 0
  
  4. Use firewall rules to restrict access:
     iptables -A INPUT -p tcp --dport 11211 -s <trusted_ip> -j ACCEPT
     iptables -A INPUT -p tcp --dport 11211 -j DROP
  
  5. Deploy behind VPN or use SSH tunneling
  
  6. Monitor for unusual traffic patterns
  
  7. Regularly update Memcached to latest version
