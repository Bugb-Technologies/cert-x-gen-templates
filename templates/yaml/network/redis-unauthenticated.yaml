id: redis-unauthenticated-access
name: "Redis Unauthenticated Access Detection"
author:
  name: "CERT-X-GEN Security Team"
  email: "security@cert-x-gen.io"
severity: critical
description: |
  Detects Redis instances exposed without authentication (requirepass disabled).
  Unauthenticated Redis allows arbitrary command execution and data exfiltration.

tags:
  - redis
  - unauthenticated
  - database
  - nosql
  - cwe-306

language: yaml
confidence: 95

# Redis typically runs on port 6379
network:
  - protocol: tcp
    port: 6379
    
    payloads:
      # Test INFO command without auth
      - "INFO\r\n"
      - "*1\r\n$4\r\nINFO\r\n"
      # Test PING command
      - "PING\r\n"
      - "*1\r\n$4\r\nPING\r\n"
      # Test CONFIG GET
      - "*2\r\n$6\r\nCONFIG\r\n$3\r\nGET\r\n*\r\n"
    
    matchers-condition: or
    matchers:
      - type: word
        words:
          - "redis_version"
          - "redis_mode"
          - "used_memory"
          - "connected_clients"
          - "role:master"
          - "role:slave"
        condition: or
        part: body
      
      - type: word
        words:
          - "+PONG"
        part: body
      
      - type: regex
        regex:
          - "\\$\\d+\\r\\nrequirepass\\r\\n"
          - "# Server\\r\\nredis_version"

http:
  - method: GET
    path:
      - "/"
      - "/metrics"
    
    matchers:
      - type: word
        words:
          - "redis_version"
          - "redis_exporter"

extractors:
  - type: regex
    name: redis_version
    regex:
      - "redis_version:(\\d+\\.\\d+\\.\\d+)"
  
  - type: regex
    name: server_role
    regex:
      - "role:(master|slave)"

remediation: |
  1. Enable authentication: Set 'requirepass' in redis.conf
  2. Bind to localhost only: Set 'bind 127.0.0.1'
  3. Use Redis ACLs (Redis 6+) for fine-grained access control
  4. Enable TLS encryption for network traffic
  5. Disable dangerous commands: rename-command CONFIG ""

references:
  - "https://redis.io/docs/management/security/"
  - "https://owasp.org/www-community/vulnerabilities/Unauthenticated_Access"
  - "CWE-306: Missing Authentication for Critical Function"
