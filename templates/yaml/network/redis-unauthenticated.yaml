id: redis-unauthenticated-access
name: "Redis Unauthenticated Access Detection"
author:
  name: "CERT-X-GEN Security Team"
  email: "security@cert-x-gen.io"
severity: critical
description: |
  Detects Redis instances exposed without authentication (requirepass disabled).
  Unauthenticated Redis allows arbitrary command execution and data exfiltration.
  
  This template tests the Redis protocol directly on port 6379 (or 6380 for replicas).
  For Redis exporter detection, use the 'redis-exporter-exposed' template.
  
  PROTOCOL FLEXIBILITY:
  - Uses 'network: protocol: tcp' for direct Redis protocol testing
  - Engine automatically detects supported protocol: TCP
  - Recommended ports: 6379 (default), 6380 (replica)

tags:
  - redis
  - unauthenticated
  - database
  - nosql
  - cache
  - network

language: yaml
confidence: 95

cwe:
  - CWE-306

references:
  - https://cwe.mitre.org/data/definitions/306.html
  - https://redis.io/docs/management/security/
  - https://owasp.org/www-community/vulnerabilities/Broken_Authentication

# Redis typically runs on port 6379 (default) or 6380 (replica)
# Default port: 6379 (can be overridden with --add-ports)
network:
  - protocol: tcp
    port: 6379  # Default port (overridden by target's port if specified)
    
    payloads:
      # Test INFO command without auth
      - "INFO\r\n"
      - "*1\r\n$4\r\nINFO\r\n"
      # Test PING command
      - "PING\r\n"
      - "*1\r\n$4\r\nPING\r\n"
      # Test CONFIG GET
      - "*2\r\n$6\r\nCONFIG\r\n$3\r\nGET\r\n*\r\n"
    
    matchers-condition: or
    matchers:
      - type: word
        words:
          - "redis_version"
          - "redis_mode"
          - "used_memory"
          - "connected_clients"
          - "role:master"
          - "role:slave"
        condition: or
        part: body
      
      - type: word
        words:
          - "+PONG"
        part: body
      
      - type: regex
        regex:
          - "\\$\\d+\\r\\nrequirepass\\r\\n"
          - "# Server\\r\\nredis_version"

extractors:
  - type: regex
    name: redis_version
    regex:
      - "redis_version:(\\d+\\.\\d+\\.\\d+)"
  
  - type: regex
    name: server_role
    regex:
      - "role:(master|slave)"

remediation: |
  1. Enable authentication: Set 'requirepass' in redis.conf
  2. Bind to localhost only: Set 'bind 127.0.0.1'
  3. Use Redis ACLs (Redis 6+) for fine-grained access control
  4. Enable TLS encryption for network traffic
  5. Disable dangerous commands: rename-command CONFIG ""
