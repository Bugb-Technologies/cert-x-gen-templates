id: prometheus-node-exporter-exposed
name: "Prometheus Node Exporter Exposed Without Authentication"
author:
  name: "CERT-X-GEN Security Team"
  email: "security@cert-x-gen.io"
severity: high
description: |
  Detects exposed Prometheus Node Exporter instances without authentication.
  Node Exporter exposes detailed system metrics including:
  - CPU, memory, disk usage
  - Network statistics
  - Process information
  - System configuration
  
  This information can aid attackers in reconnaissance and system profiling.

tags:
  - prometheus
  - node-exporter
  - metrics
  - information-disclosure
  - monitoring
  - cwe-200

language: yaml
confidence: 95

http:
  - method: GET
    path:
      - "/metrics"
      - "/node_exporter/metrics"
      - ":9100/metrics"
      - ":9100/"
    
    matchers-condition: and
    matchers:
      - type: word
        words:
          - "node_exporter"
          - "node_"
        condition: or
        part: body
      
      - type: word
        words:
          - "# HELP"
          - "# TYPE"
        condition: or
        part: body
      
      - type: regex
        regex:
          - 'node_cpu_seconds_total'
          - 'node_memory_.*_bytes'
          - 'node_filesystem_.*_bytes'
          - 'node_network_.*_bytes'
          - 'node_uname_info'
        condition: or

extractors:
  - type: regex
    name: os_info
    regex:
      - 'node_uname_info{.*domainname="([^"]*)",.*nodename="([^"]*)",.*release="([^"]*)",.*sysname="([^"]*)".*}'
  
  - type: regex
    name: hostname
    regex:
      - 'nodename="([^"]*)"'
  
  - type: regex
    name: kernel_version
    regex:
      - 'release="([^"]*)"'
  
  - type: regex
    name: os_type
    regex:
      - 'sysname="([^"]*)"'

severity-details:
  high:
    description: "Exposed metrics reveal system architecture and potential vulnerabilities"
    cvss_score: 7.5
    
remediation: |
  1. Enable authentication using reverse proxy (Nginx/Apache):
     location /metrics {
       auth_basic "Prometheus Metrics";
       auth_basic_user_file /etc/nginx/.htpasswd;
       proxy_pass http://localhost:9100;
     }

  2. Use TLS encryption:
     - Configure reverse proxy with SSL
     - Use Prometheus with TLS authentication

  3. Bind to localhost only:
     node_exporter --web.listen-address="127.0.0.1:9100"

  4. Use firewall rules:
     iptables -A INPUT -p tcp --dport 9100 -s <prometheus_server_ip> -j ACCEPT
     iptables -A INPUT -p tcp --dport 9100 -j DROP

  5. Implement network segmentation
  
  6. Use VPN or SSH tunneling for remote access

  7. Enable basic auth in newer versions:
     node_exporter --web.config.file=web-config.yml
     # web-config.yml with basic auth settings

  8. Monitor access logs for suspicious activity

  9. Consider using Prometheus Operator with proper RBAC

  10. Regularly audit exposed metrics

references:
  - "https://prometheus.io/docs/guides/basic-auth/"
  - "https://github.com/prometheus/node_exporter#tls-and-basic-authentication"
  - "https://prometheus.io/docs/prometheus/latest/configuration/https/"
  - "CWE-200: Exposure of Sensitive Information to an Unauthorized Actor"
  
exposed_metrics_impact:
  - "System hostname and domain"
  - "Kernel version (vulnerability identification)"
  - "CPU architecture and count"
  - "Memory capacity and usage patterns"
  - "Disk layout and mount points"
  - "Network interfaces and traffic"
  - "Running processes and services"
  - "System uptime and boot time"
  - "Timezone and locale settings"
