# CERT-X-GEN YAML Template Skeleton

id: check-metrics-endpoint
name: "Check /metrics Endpoint Exposure"
author:
  name: "Shahid Hakimji"
  email: "shahid@bugb.report"
  github: "@zippon"
severity: medium
description: |
  This template checks if the /metrics endpoint is exposed and accessible.
  Exposed metrics endpoints can reveal sensitive system information, performance data,
  and internal application state that could be leveraged by attackers for reconnaissance.

tags:
  - security
  - metrics
  - endpoint
  - information-disclosure

language: yaml
confidence: 90

created: "2024-01-15T00:00:00Z"
modified: "2024-01-15T00:00:00Z"

classification:
  category: information-disclosure
  subcategory: metrics-exposure
  service: monitoring

cve_ids: []
cwe_ids:
  - "CWE-200"  # Exposure of Sensitive Information to an Unauthorized Actor
  - "CWE-497"  # Exposure of Sensitive System Information to an Unauthorized Actor
cvss_score: 5.3
version: "1.0.0"

references:
  - https://cwe.mitre.org/data/definitions/200.html
  - https://cwe.mitre.org/data/definitions/497.html
  - https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config

http:
  - method: GET
    path:
      - "/metrics"

    headers:
      User-Agent: "cert-x-gen/1.0"

    max-redirects: 2
    timeout: 10s

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "go_goroutines"
          - "process_cpu_seconds"
          - "http_requests_total"
        condition: or
        part: body

    extractors:
      - type: regex
        name: metrics_type
        regex:
          - "TYPE\\s+(\\w+)\\s+"
        group: 1

      - type: regex
        name: metrics_count
        regex:
          - "#\\s+TYPE\\s+\\w+\\s+\\w+"
        group: 0

remediation: |
  1. If the /metrics endpoint is not intended to be publicly accessible, implement proper access controls such as authentication, authorization, or IP whitelisting.
  2. Consider moving metrics endpoints to internal networks or using reverse proxies with authentication.
  3. For Prometheus-based applications, configure scrape configurations to use appropriate authentication methods.
  4. Regularly monitor and audit access to metrics endpoints to detect unauthorized access attempts.
  5. Implement network segmentation to restrict access to monitoring infrastructure.
